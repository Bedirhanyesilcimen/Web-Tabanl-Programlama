@model List<WorkFlowApp.Models.TekstilStok>
@{ 
    ViewData["Title"] = "Sentetik Takip"; 
    var secilenTarih = (DateTime)ViewBag.SecilenTarih;
    bool isGM = User.IsInRole("GenelMudur");
}

<div class="container-fluid mt-3">
    <div class="card shadow-sm mb-4 border-0">
        <div class="card-body py-3">
            <div class="row align-items-center g-3">
                <div class="col-md-3">
                    <h3 class="text-info fw-bold mb-0"><i class="fas fa-layer-group"></i> Sentetik Bölümü</h3>
                </div>

                <div class="col-md-5 d-flex justify-content-center">
                    <form action="/Depo/TekstilSentetik" method="get" class="d-flex align-items-center gap-2 bg-light p-2 rounded border">
                        <label class="fw-bold text-secondary mb-0">Tarih:</label>
                        <input type="date" name="tarih" class="form-control form-control-sm text-center" value="@secilenTarih.ToString("yyyy-MM-dd")" onchange="this.form.submit()">
                    </form>
                </div>

                <div class="col-md-4 d-flex justify-content-end">
                    @if (!isGM) {
                        <form action="/Depo/TekstilExcelYukle" method="post" enctype="multipart/form-data" class="d-flex gap-2 align-items-center">
                            <input type="file" name="excelDosyasi" class="form-control form-control-sm" required>
                            <button class="btn btn-sm btn-success fw-bold">YÜKLE</button>
                        </form>
                    } else {
                        <span class="badge bg-secondary p-2"><i class="fas fa-eye"></i> İzleme Modu (Yetkisiz)</span>
                    }
                </div>

                <div class="col-12 d-flex justify-content-between align-items-center border-top pt-2 mt-2">
                    <input type="text" id="sentetikSearch" class="form-control form-control-sm w-50 shadow-sm" placeholder="Sentetik stoklarda ara..." onkeyup="tabloFiltrele('sentetikSearch')">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="zeroToggle" onchange="toggleZeroRows()">
                        <label class="form-check-label small fw-bold" for="zeroToggle">Sıfırları Gizle</label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="bg-white p-3 shadow-sm border">
        @await Html.PartialAsync("_StokTablosu", Model)
    </div>
</div>

<script>
    function tabloFiltrele(inputId) {
        var filter = document.getElementById(inputId).value.toUpperCase();
        document.querySelectorAll("table tbody tr").forEach(row => {
            row.style.display = row.innerText.toUpperCase().includes(filter) ? "" : "none";
        });
    }

    function toggleZeroRows() {
        var isHidden = document.getElementById("zeroToggle").checked;
        document.querySelectorAll("table tbody tr").forEach(row => {
            var inputs = row.getElementsByTagName("input");
            var val = inputs.length > 0 ? parseFloat(inputs[0].value) : 0;
            if (val === 0) row.style.display = isHidden ? "none" : "";
        });
    }

    function stokMiktarGuncelle(input, id) {
        if ("@isGM" === "True") { alert("Yetkiniz yok!"); input.value = input.defaultValue; return; }
    }
</script>
